<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.library.mapper.UserMapper">

    <select id="findUsersByPage" resultType="com.library.entity.User">
        SELECT * FROM sys_user 
        WHERE is_deleted = 0
        <if test="params.keyword != null and params.keyword != ''">
            AND (username LIKE CONCAT('%', #{params.keyword}, '%') 
                 OR nickname LIKE CONCAT('%', #{params.keyword}, '%')
                 OR email LIKE CONCAT('%', #{params.keyword}, '%')
                 OR phone LIKE CONCAT('%', #{params.keyword}, '%'))
        </if>
        <choose>
            <when test="params.sortBy != null and params.sortBy != ''">
                ORDER BY ${params.sortBy} ${params.orderBy}
            </when>
            <otherwise>
                ORDER BY create_time DESC
            </otherwise>
        </choose>
    </select>

    <select id="findByUsername" parameterType="java.lang.String" resultType="com.library.entity.User">
        SELECT * FROM sys_user WHERE username = #{username} AND is_deleted = 0
    </select>

    <update id="updateUser" parameterType="com.library.entity.User">
        UPDATE sys_user
        SET username = #{username},
            password = #{password},
            nickname = #{nickname},
            email = #{email},
            phone = #{phone},
            avatar = #{avatar},
            status = #{status},
            update_time = NOW()
        WHERE id = #{id}
    </update>

    <update id="deleteUser" parameterType="java.lang.Long">
        UPDATE sys_user SET is_deleted = 1 WHERE id = #{id}
    </update>

</mapper>